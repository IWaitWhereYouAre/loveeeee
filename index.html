<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Heart to Heart | ISA Chulalongkorn</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400&family=Pinyon+Script&display=swap');

    :root {
      --gold: #c5a059;
      --deep-green: #1a2a1d;
      --cream: #f8f5f0;
      --blush: #e8d5d1;
    }

    body {
      background-color: var(--cream);
      color: var(--deep-green);
      font-family: 'Lato', sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      transition: background-color 2s ease;
      overflow: hidden;
      position: relative;
    }

    /* =========================
       SECRET GARDEN BACKGROUND
       ========================= */
    .garden-bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
      background:
        radial-gradient(900px 700px at 20% 20%, rgba(197,160,89,0.14), transparent 60%),
        radial-gradient(800px 650px at 80% 30%, rgba(232,213,209,0.18), transparent 55%),
        radial-gradient(900px 700px at 40% 90%, rgba(26,42,29,0.14), transparent 55%),
        linear-gradient(120deg, rgba(248,245,240,1), rgba(248,245,240,1));
    }

    /* moving “mist + garden light” */
    .garden-bg::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,0.55), transparent 55%),
        radial-gradient(circle at 70% 40%, rgba(255,255,255,0.35), transparent 60%),
        radial-gradient(circle at 50% 70%, rgba(255,255,255,0.25), transparent 65%),
        linear-gradient(120deg, rgba(197,160,89,0.08), rgba(232,213,209,0.10), rgba(26,42,29,0.06));
      filter: blur(18px);
      opacity: 0.9;
      animation: gardenDrift 18s ease-in-out infinite;
      transform: translate3d(0,0,0);
    }

    /* subtle paper texture */
    .garden-bg::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png");
      opacity: 0.55;
      mix-blend-mode: multiply;
    }

    @keyframes gardenDrift {
      0%   { transform: translate(-4%, -2%) rotate(-2deg); }
      50%  { transform: translate(4%, 2%) rotate(2deg); }
      100% { transform: translate(-4%, -2%) rotate(-2deg); }
    }

    /* princess silhouette + trees/flowers vibe (inline SVG as background layer) */
    .garden-silhouette {
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none;
      opacity: 0.18;
      background-repeat: no-repeat;
      background-position: 80% 78%;
      background-size: min(520px, 70vw);
      filter: blur(0.2px);
      mix-blend-mode: multiply;
      background-image:
        url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 800'>\
  <defs>\
    <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>\
      <stop offset='0' stop-color='%231a2a1d' stop-opacity='0.9'/>\
      <stop offset='1' stop-color='%23c5a059' stop-opacity='0.6'/>\
    </linearGradient>\
  </defs>\
  <!-- trees -->\
  <path d='M90 720 C120 600 140 520 170 420 C190 340 170 260 150 220 C220 250 260 330 270 410 C280 510 250 600 240 720 Z' fill='url(%23g)' opacity='0.55'/>\
  <path d='M650 740 C630 610 610 520 590 430 C560 330 590 260 620 220 C540 250 500 330 500 410 C500 520 540 620 560 740 Z' fill='url(%23g)' opacity='0.45'/>\
  <!-- princess silhouette (simple) -->\
  <path d='M430 650 C420 610 410 580 400 550 C390 520 390 500 400 470 C410 440 430 420 450 410 C455 395 450 380 440 370 C470 360 505 380 500 410 C515 430 535 455 535 490 C535 520 520 550 500 575 C495 600 492 625 500 650 C475 660 455 660 430 650 Z' fill='%231a2a1d' opacity='0.9'/>\
  <circle cx='460' cy='360' r='26' fill='%231a2a1d' opacity='0.9'/>\
  <!-- flowers -->\
  <g opacity='0.5'>\
    <circle cx='120' cy='690' r='10' fill='%23c5a059'/>\
    <circle cx='140' cy='700' r='8' fill='%23e8d5d1'/>\
    <circle cx='160' cy='690' r='9' fill='%23c5a059'/>\
    <circle cx='680' cy='700' r='10' fill='%23e8d5d1'/>\
    <circle cx='700' cy='710' r='8' fill='%23c5a059'/>\
    <circle cx='720' cy='700' r='9' fill='%23e8d5d1'/>\
  </g>\
</svg>");
    }

    /* floating petals */
    .petals {
      position: fixed;
      inset: 0;
      z-index: 2;
      pointer-events: none;
      overflow: hidden;
    }
    .petal {
      position: absolute;
      top: -10%;
      width: 10px;
      height: 16px;
      border-radius: 60% 40% 60% 40%;
      background: rgba(232,213,209,0.55);
      box-shadow: 0 0 0 1px rgba(197,160,89,0.08);
      filter: blur(0.15px);
      animation: fall linear infinite;
      transform: rotate(12deg);
      opacity: 0.85;
    }
    @keyframes fall {
      0%   { transform: translate3d(0, -20px, 0) rotate(10deg); }
      100% { transform: translate3d(0, 120vh, 0) rotate(260deg); }
    }

    /* Decorative Elements */
    .vignette {
      position: fixed; inset: 0;
      background: radial-gradient(circle, transparent 50%, rgba(26, 42, 29, 0.1));
      pointer-events: none; z-index: 5;
    }
    .botanical { position: fixed; width: 450px; opacity: 0.12; pointer-events: none; z-index: 3; }
    .top-left { top: -120px; left: -120px; transform: rotate(15deg); }
    .bottom-right { bottom: -120px; right: -120px; transform: rotate(195deg); }

    #app-container { text-align: center; max-width: 1000px; width: 100%; z-index: 10; padding: 20px; position: relative; }

    /* Branding Headers */
    .isa-tag { font-size: 0.65rem; letter-spacing: 5px; text-transform: uppercase; margin-bottom: 10px; opacity: 0.7; }
    h1.main-title { font-family: 'Pinyon Script', cursive; font-size: 5rem; color: var(--gold); margin: 0; line-height: 1; }
    .sub-theme { font-family: 'Playfair Display', serif; font-size: 1rem; letter-spacing: 10px; text-transform: uppercase; margin-bottom: 50px; }

    /* Deck Area */
    .deck-area { position: relative; height: 400px; width: 100%; display: flex; justify-content: center; align-items: center; }
    .card {
      position: absolute; width: 180px; height: 260px; background: #fff;
      border-radius: 2px; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      cursor: pointer; transition: all 0.8s cubic-bezier(0.2, 1, 0.3, 1); overflow: hidden;
    }
    .card::after {
      content: ''; position: absolute; inset: 10px; border: 1px solid var(--gold);
      background-color: var(--deep-green); background-image: url("https://www.transparenttextures.com/patterns/dark-matter.png");
    }
    .card-crest { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--gold); font-family: 'Playfair Display', serif; font-size: 2rem; z-index: 2; opacity: 0.6; }

    /* Result View */
    #result-screen { display: none; opacity: 0; }

    #capture-frame {
      background: #fff;
      padding: 60px 40px;
      width: 380px;
      margin: 0 auto;
      position: relative;
      border: 1px solid rgba(197, 160, 89, 0.2);
      box-shadow: 0 30px 60px rgba(0,0,0,0.05);
      background-image: url("https://www.transparenttextures.com/patterns/paper-fibers.png");
    }
    #capture-frame::before {
      content: ""; position: absolute; inset: 15px;
      border: 0.5px solid var(--gold); pointer-events: none;
    }

    .result-isa { font-size: 0.55rem; letter-spacing: 4px; text-transform: uppercase; color: var(--gold); display: block; margin-bottom: 20px; }
    .result-theme { font-family: 'Pinyon Script', cursive; font-size: 2.8rem; color: var(--deep-green); margin: 0; }
    .quote-box { font-family: 'Playfair Display', serif; font-size: 1.8rem; line-height: 1.4; margin: 40px 0; font-style: italic; }
    .quote-author { font-family: 'Lato', sans-serif; font-size: 0.7rem; letter-spacing: 3px; text-transform: uppercase; opacity: 0.6; }

    .recommendation { display: flex; justify-content: space-between; margin-top: 40px; padding-top: 30px; border-top: 0.5px solid rgba(0,0,0,0.1); text-align: left; }
    .rec-label { font-size: 0.5rem; letter-spacing: 2px; text-transform: uppercase; color: var(--gold); display: block; }
    .rec-val { font-family: 'Playfair Display', serif; font-size: 0.9rem; }

    /* Buttons */
    .btn-group { margin-top: 40px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
    .btn {
      background: none; border: 1px solid var(--gold); padding: 12px 25px;
      font-family: 'Lato', sans-serif; text-transform: uppercase; letter-spacing: 2px;
      font-size: 0.7rem; cursor: pointer; transition: 0.3s;
      backdrop-filter: blur(4px);
    }
    .btn-save { background: var(--gold); color: white; }
    .btn-save:hover { background: var(--deep-green); border-color: var(--deep-green); }

    /* Sound toggle button */
    .btn-sound {
      border-color: rgba(197,160,89,0.65);
      color: var(--deep-green);
      background: rgba(255,255,255,0.45);
    }
    .btn-sound.active {
      background: rgba(26,42,29,0.85);
      color: #fff;
      border-color: rgba(26,42,29,0.85);
    }

    @media (max-width: 450px) {
      #capture-frame { width: 85vw; padding: 40px 20px; }
      h1.main-title { font-size: 3.5rem; }
    }
  </style>
</head>

<body>
  <!-- Secret garden layers -->
  <div class="garden-bg"></div>
  <div class="garden-silhouette"></div>
  <div class="petals" id="petals"></div>

  <div class="vignette"></div>
  <img src="https://www.transparenttextures.com/patterns/flowers.png" class="botanical top-left" />
  <img src="https://www.transparenttextures.com/patterns/flowers.png" class="botanical bottom-right" />

  <div id="app-container">
    <div id="ritual-screen">
      <p class="isa-tag">ISA Chulalongkorn Presents</p>
      <h1 class="main-title">Heart to Heart</h1>
      <p class="sub-theme">The Secret Garden</p>

      <div class="deck-area" id="deck-container"></div>
      <p id="status-text" style="margin-top: 40px; font-size: 0.7rem; letter-spacing: 3px; text-transform: uppercase;">
        Tap the deck to begin
      </p>

      <div class="btn-group" style="margin-top:18px;">
        <button class="btn btn-sound" id="soundBtn" type="button">Sound: Off</button>
      </div>
      <p style="font-size:0.6rem; opacity:0.55; letter-spacing:1px; margin-top:10px;">
        (Tap “Sound” once — browsers require user interaction.)
      </p>
    </div>

    <div id="result-screen">
      <div id="capture-frame">
        <span class="result-isa">ISA Chulalongkorn</span>
        <h2 class="result-theme">Heart to Heart</h2>
        <div class="quote-box" id="quote-text"></div>
        <div class="quote-author" id="quote-source"></div>

        <div class="recommendation">
          <div>
            <span class="rec-label">Cinematic</span>
            <span class="rec-val" id="movie-title"></span>
          </div>
          <div>
            <span class="rec-label">Literary</span>
            <span class="rec-val" id="book-title"></span>
          </div>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn" onclick="location.reload()">Reset</button>
        <button class="btn btn-save" onclick="saveImage()">Save Picture</button>
        <button class="btn btn-sound" id="soundBtn2" type="button">Sound: Off</button>
      </div>
      <p style="font-size: 0.6rem; margin-top: 20px; opacity: 0.5; letter-spacing: 1px;">
        Saved to your downloads folder
      </p>
    </div>
  </div>

  <script>
    /* =========================
       PETALS (animated garden)
       ========================= */
    const petalsHost = document.getElementById('petals');
    function spawnPetals(count = 16) {
      petalsHost.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.className = 'petal';
        const left = Math.random() * 100;
        const dur = 10 + Math.random() * 12;
        const delay = Math.random() * 8;
        const size = 8 + Math.random() * 10;
        p.style.left = left + 'vw';
        p.style.animationDuration = dur + 's';
        p.style.animationDelay = delay + 's';
        p.style.width = size + 'px';
        p.style.height = (size * 1.5) + 'px';
        p.style.opacity = (0.45 + Math.random() * 0.45).toFixed(2);
        petalsHost.appendChild(p);
      }
    }
    spawnPetals(18);
    window.addEventListener('resize', () => spawnPetals(window.innerWidth < 480 ? 12 : 18));

    /* =========================
       SOUND: Wind + Birds (WebAudio)
       ========================= */
    let audioCtx = null;
    let masterGain = null;
    let windGain = null;
    let windNode = null;
    let birdTimer = null;
    let soundOn = false;

    function ensureAudio() {
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      masterGain = audioCtx.createGain();
      masterGain.gain.value = 0.0; // start muted
      masterGain.connect(audioCtx.destination);

      // WIND: filtered noise
      const bufferSize = 2 * audioCtx.sampleRate;
      const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const output = noiseBuffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) output[i] = Math.random() * 2 - 1;

      const noise = audioCtx.createBufferSource();
      noise.buffer = noiseBuffer;
      noise.loop = true;

      const bandpass = audioCtx.createBiquadFilter();
      bandpass.type = 'bandpass';
      bandpass.frequency.value = 420;
      bandpass.Q.value = 0.6;

      const lowpass = audioCtx.createBiquadFilter();
      lowpass.type = 'lowpass';
      lowpass.frequency.value = 900;

      windGain = audioCtx.createGain();
      windGain.gain.value = 0.08;

      // slow “gust” modulation
      const lfo = audioCtx.createOscillator();
      lfo.type = 'sine';
      lfo.frequency.value = 0.06;
      const lfoGain = audioCtx.createGain();
      lfoGain.gain.value = 0.06;
      lfo.connect(lfoGain);
      lfoGain.connect(windGain.gain);

      noise.connect(bandpass);
      bandpass.connect(lowpass);
      lowpass.connect(windGain);
      windGain.connect(masterGain);

      noise.start();
      lfo.start();

      windNode = noise;
    }

    function chirpOnce() {
      if (!audioCtx || !soundOn) return;

      // a tiny bird chirp: quick pitch sweep sine
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      const filter = audioCtx.createBiquadFilter();

      osc.type = 'sine';
      filter.type = 'bandpass';
      filter.frequency.value = 2500;
      filter.Q.value = 6;

      const now = audioCtx.currentTime;
      const base = 1600 + Math.random() * 900;

      osc.frequency.setValueAtTime(base, now);
      osc.frequency.exponentialRampToValueAtTime(base * (1.4 + Math.random() * 0.4), now + 0.08);

      gain.gain.setValueAtTime(0.0001, now);
      gain.gain.exponentialRampToValueAtTime(0.09, now + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.18);

      osc.connect(filter);
      filter.connect(gain);
      gain.connect(masterGain);

      osc.start(now);
      osc.stop(now + 0.22);
    }

    function startBirds() {
      stopBirds();
      const schedule = () => {
        const t = 1400 + Math.random() * 2800; // 1.4s–4.2s
        birdTimer = setTimeout(() => {
          // sometimes double chirp
          chirpOnce();
          if (Math.random() > 0.6) setTimeout(chirpOnce, 180 + Math.random() * 140);
          schedule();
        }, t);
      };
      schedule();
    }

    function stopBirds() {
      if (birdTimer) {
        clearTimeout(birdTimer);
        birdTimer = null;
      }
    }

    async function setSound(on) {
      ensureAudio();
      if (audioCtx.state === 'suspended') {
        try { await audioCtx.resume(); } catch(e) {}
      }
      soundOn = on;
      if (masterGain) masterGain.gain.value = on ? 0.9 : 0.0;

      if (on) startBirds();
      else stopBirds();

      updateSoundButtons();
    }

    function toggleSound() {
      setSound(!soundOn);
    }

    function updateSoundButtons() {
      const label = soundOn ? 'Sound: On' : 'Sound: Off';
      const btns = [document.getElementById('soundBtn'), document.getElementById('soundBtn2')].filter(Boolean);
      btns.forEach(b => {
        b.textContent = label;
        b.classList.toggle('active', soundOn);
      });
    }

    document.getElementById('soundBtn').addEventListener('click', toggleSound);

    /* =========================
       Your existing logic
       ========================= */
    const colorPalette = [
      { name: "Ivory Silk", hex: "#fffdf0", quote: "To love at all is to be vulnerable.", source: "C.S. Lewis", movie: "Shadowlands", movieDesc: "Love understood through loss.", book: "The Four Loves", bookDesc: "A philosophical anatomy of affection." },
      { name: "Vintage Champagne", hex: "#f5ead0", quote: "Love is not blind; it sees more, not less.", source: "Erich Fromm", movie: "In the Mood for Love", movieDesc: "Restraint and recognition without possession.", book: "A Lover's Discourse", bookDesc: "Love experienced as a series of fragments." },
      { name: "Tudor Rose", hex: "#fce3e3", quote: "Everything that frightens us is something helpless that wants our love.", source: "Rainer Maria Rilke", movie: "The Shape of Water", movieDesc: "Tenderness toward the unfamiliar.", book: "Letters to a Young Poet", bookDesc: "Solitude as the ground of mature love." },
      { name: "English Lavender", hex: "#e8e1f5", quote: "It is not necessary to hurry intimacy.", source: "Anne Carson", movie: "Before Sunset", movieDesc: "Connection shaped by time.", book: "Eros the Bittersweet", bookDesc: "Desire defined by distance." },
      { name: "Versailles Sage", hex: "#e2ede4", quote: "The world is full of magic things, patiently waiting for our senses to grow sharper.", source: "W.B. Yeats", movie: "Song of the Sea", movieDesc: "Myth as a form of care.", book: "The Wind Among the Reeds", bookDesc: "Poetry of perception and longing." },
      { name: "Gilded Moss", hex: "#ecebbd", quote: "The only way to make sense out of change is to plunge into it.", source: "Alan Watts", movie: "Spring, Summer, Fall, Winter... and Spring", movieDesc: "The cyclical nature of the soul.", book: "The Wisdom of Insecurity", bookDesc: "Finding love in the ephemeral." },
      { name: "Biedermeier Blue", hex: "#e0f0f5", quote: "Loneliness is the poverty of self; solitude is the richness of self.", source: "May Sarton", movie: "Lost in Translation", movieDesc: "Distance without deficiency.", book: "Journal of a Solitude", bookDesc: "A defense of the inner life." },
      { name: "Old Manor Taupe", hex: "#ede6e1", quote: "Acceptance is a small, quiet room.", source: "Cheryl Strayed", movie: "Nomadland", movieDesc: "Dignity without possession.", book: "Tiny Beautiful Things", bookDesc: "Love as presence." },
      { name: "Terracotta Sundial", hex: "#f5e6d3", quote: "Beauty is in things imperfect, impermanent, and incomplete.", source: "Leonard Koren", movie: "Arrietty", movieDesc: "Care without ownership.", book: "The Beauty of the Ordinary", bookDesc: "Everyday aesthetics." },
      { name: "Slate Manor", hex: "#e1e6e8", quote: "Love is the extremely difficult realization that something other than oneself is real.", source: "Iris Murdoch", movie: "Eternal Sunshine of the Spotless Mind", movieDesc: "The messy reality of modern memory.", book: "The Sovereignty of Good", bookDesc: "Love as the destruction of the ego." },
      { name: "Linen Prayer", hex: "#fcfaf7", quote: "Love is not a relationship between one person and another, but a relationship between a person and love itself.", source: "Søren Kierkegaard", movie: "Still Walking", movieDesc: "Care expressed through repetition.", book: "Works of Love", bookDesc: "An ethical account of love." },
      { name: "Orchard Ash", hex: "#f0f0f0", quote: "Love, by its very nature, is unworldly.", source: "Hannah Arendt", movie: "A Hidden Life", movieDesc: "Love that refuses usefulness.", book: "The Human Condition", bookDesc: "Love, labor, and political life." },
      { name: "Cemetery Stone", hex: "#e3e3e3", quote: "To be alone is to be with the world without intermediaries.", source: "Maurice Blanchot", movie: "Taste of Cherry", movieDesc: "Existence without narrative.", book: "The Space of Literature", bookDesc: "Solitude as encounter." },
      { name: "Pale Concrete", hex: "#ededeb", quote: "Nothing is missing. Something is simply not added.", source: "Gilles Deleuze", movie: "Columbus", movieDesc: "Meaning found without completion.", book: "Negotiations", bookDesc: "Absence understood as difference." },
      { name: "Oat Chapel", hex: "#f3eddc", quote: "Love is an act of faith, and whoever is of little faith is also of little love.", source: "Erich Fromm", movie: "Ordet", movieDesc: "Love understood as faith.", book: "The Art of Loving", bookDesc: "Love as a skill, not a feeling." },
      { name: "Ash Rose", hex: "#e6dede", quote: "Grief is the final manifestation of love.", source: "Joan Didion", movie: "Aftersun", movieDesc: "A portrait of memory.", book: "Blue Nights", bookDesc: "A meditation on loss." }
    ];

    const deck = document.getElementById('deck-container');
    const status = document.getElementById('status-text');
    let shuffleState = 0;

    function createDeck() {
      for (let i = 0; i < 12; i++) {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.zIndex = i;
        card.innerHTML = '<div class="card-crest">❦</div>';
        card.style.transform = `translate(${i * 0.5}px, ${i * 0.5}px)`;

        card.onclick = () => {
          // Start audio on first real interaction (autoplay safe)
          if (!audioCtx) ensureAudio();

          if (shuffleState < 3) runShuffle();
          else if (shuffleState === 4) revealCard();
        };

        deck.appendChild(card);
      }
    }

    function runShuffle() {
      shuffleState++;

      // if user has not enabled sound yet, gently “prime” audio without forcing it on
      // (still muted unless they toggle Sound: On)
      ensureAudio();

      const cards = document.querySelectorAll('.card');
      cards.forEach((card) => {
        const rx = (Math.random() - 0.5) * 400;
        const ry = (Math.random() - 0.5) * 400;
        const rr = (Math.random() - 0.5) * 100;
        card.style.transform = `translate(${rx}px, ${ry}px) rotate(${rr}deg)`;
      });
      status.innerText = `Shuffling Intentions... (${shuffleState}/3)`;
      setTimeout(() => {
        cards.forEach((card, i) => card.style.transform = `translate(${i * 0.3}px, ${i * 0.3}px) rotate(0deg)`);
        if (shuffleState === 3) setTimeout(fanCards, 600);
      }, 800);
    }

    function fanCards() {
      const cards = document.querySelectorAll('.card');
      shuffleState = 4;
      status.innerText = "Draw your heart's secret";
      cards.forEach((card, i) => {
        const angle = (i - 5.5) * 8;
        const x = (i - 5.5) * 40;
        card.style.transform = `translate(${x}px, 20px) rotate(${angle}deg)`;
      });
    }

    function revealCard() {
      const data = colorPalette[Math.floor(Math.random() * colorPalette.length)];
      document.getElementById('ritual-screen').style.opacity = '0';
      document.body.style.backgroundColor = data.hex;

      setTimeout(() => {
        document.getElementById('ritual-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.getElementById('quote-text').innerText = data.quote;
        document.getElementById('quote-source').innerText = `— ${data.source}`;
        document.getElementById('movie-title').innerText = data.movie;
        document.getElementById('book-title').innerText = data.book;
        setTimeout(() => { document.getElementById('result-screen').style.opacity = '1'; }, 100);

        // attach second sound button once result screen exists
        const b2 = document.getElementById('soundBtn2');
        if (b2 && !b2.dataset.bound) {
          b2.dataset.bound = "1";
          b2.addEventListener('click', toggleSound);
          updateSoundButtons();
        }
      }, 1000);
    }

    // Save Image
    function saveImage() {
      const captureArea = document.getElementById('capture-frame');
      html2canvas(captureArea, { backgroundColor: null, scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'HeartToHeart_ISA.png';
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }

    // bind the main sound button
    document.getElementById('soundBtn').addEventListener('click', toggleSound);
    updateSoundButtons();

    createDeck();
  </script>
</body>
</html>
